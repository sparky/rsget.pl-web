index:	0
title:	4Shared
desc:	[4S] <a href="http://www.4shared.com/">"http://www.4shared.com/"</a>

body:	
	<p>Check <a href="http://www.4shared.com/terms.jsp">terms of service</a>.</p>
<p>Status: OK 2010-04-05</p>
	<pre># $Id: 4Shared 11311 2010-04-05 20:34:55Z sparky $
# Get::4Shared - File getter plugin for rsget.pl
#
# 2009-2010 (c) Przemys≈Çaw Iskra &lt;sparky@pld-linux.org&gt;
#		This program is free software,
# you may distribute it under GPL v2 or newer.

# TODO: support images, and probably other content

name: 4Shared
short: 4S
web: "http://www.4shared.com/"
tos: "http://www.4shared.com/terms.jsp"
uri: qr{4shared\.com/(account/)?file/}
slots: max
status: OK 2010-04-05

unify:
	return "http://www.4shared.com/file/$1/$2"
		if m{/file/(\d+)/([0-9a-f]+)};

start:
	GET( $-{_uri} );

	ERROR( "file not found" )
		if m{^\s*&lt;img alt="" src="/images/spacer\.gif" class="warn" hspace="3" align="left" /&gt;\s*$}m;

	! m{window\.location = ".*/(.*?)\?tsid=.*";};
	my $name = uri_unescape( $1 );

	! m{&lt;td class="finforight"&gt;(\d+(?:,\d+)? KB)&lt;/td&gt;}s;
	my $size = $1;
	$size =~ tr/,/./;
	INFO( name =&gt; $name, asize =&gt; $size );

	! m{&lt;a href="(.*?)" class="dbtn" tabindex="1"&gt;};
	CLICK( $1 );

	! m{id='divDLStart' &gt;\s*&lt;a href='(.*?)'&gt;};
	$-{file_uri} = $1;

	! /var c = (\d+);/;
	WAIT( $1, "starting download" );

	CLICK_DOWNLOAD( $-{file_uri} );

# vim: filetype=perl:ts=4:sw=4
</pre>
