index:	0
title:	RapidShare
desc:	[RS] <a href="http://rapidshare.com/" rel="nofollow">"http://rapidshare.com/"</a>

body:	
	<p>Check <a href="http://rapidshare.com/#!rapidshare-ag/rapidshare-ag_agb" rel="nofollow">terms of service</a>.</p>
<p>Status: OK 2010-10-04</p>
	<pre># $Id: RapidShare 11899 2010-11-06 21:32:33Z sparky $
# Get::RapidShare - File getter plugin for rsget.pl
#
# 2009-2010 (c) Przemys≈Çaw Iskra &lt;sparky@pld-linux.org&gt;
#		This program is free software,
# you may distribute it under GPL v2 or newer.

name: RapidShare
short: RS
web: "http://rapidshare.com/"
tos: "http://rapidshare.com/#!rapidshare-ag/rapidshare-ag_agb"
uri: qr{(?:rs[a-z0-9]+\.)?rapidshare\.com/files/\d+/.+}
uri: qr{(?:rs[a-z0-9]+\.)?rapidshare\.com/?#!download\|\d+\|\d+\|.+?\|\d+}
uri: qr{(?:rs[a-z0-9]+\.)?rapidshare\.de/files/\d+/.+}
uri: qr{(?:rs[a-z0-9]+\.)?rapidshare\.de/?#!download\|\d+\|\d+\|.+?\|\d+}
status: OK 2010-10-04

unify:
	return $_;

start:
	GET( $-{_uri} );

	RESTART( -300, "must wait: $1" )
		if /^ERROR: (Please stop floo.*|All free download slots are full.*)/;

	ERROR( "file not found: $1" )
		if /^ERROR: (.*)/
			and substr( $1, 0, 16 ) ne "You need to wait"
			and substr( $1, 0, 17 ) ne "You need RapidPro";

	GOTO stage_uri_complete
		unless m{&lt;script type="text/javascript"&gt;location="(.*?)"};
	$-{_referer} = undef;
	GET( "http://rapidshare.com$1" );

stage_uri_complete:
	! ( $-{id}, $-{name}, my $size ) = $-{_referer} =~ m{#!download\|\d+\|(\d+)\|(.+?)\|(\d+)};
	INFO( name =&gt; $-{name}, asize =&gt; "$size KB" );
	
	CLICK( "http://api.rapidshare.com/cgi-bin/rsapi.cgi?sub=download_v1&amp;try=1&amp;fileid=$-{id}&amp;filename=$-{name}" );

	MULTI( $1 )
		if /^(ERROR: You need RapidPro.*)/;
	RESTART( -$2, "free limit reached: $1" )
		if /^(ERROR: You need to wait (\d+) seconds.*)/;

	! my ( $host, $dlauth, $wait ) = m{DL:(.*?),([0-9A-F]+?),(\d+)};

	$-{file_uri} = "http://$host/cgi-bin/rsapi.cgi?sub=download_v1&amp;dlauth=$dlauth&amp;bin=1&amp;fileid=$-{id}&amp;filename=$-{name}";

	WAIT( $wait, "starting download" );

	DOWNLOAD( $-{file_uri} );

# vim: filetype=perl:ts=4:sw=4
</pre>
