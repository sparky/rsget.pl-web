#!/bin/sh

set -e
set -x

svn co http://svn.pld-linux.org/svn/toys/rsget.pl svn

rm -rf rsget.pl
./file_info.pl
./getter_info.pl
./generator.pl

find rsget.pl -name "index.xml" -o -name "error*.xml" \
	| xargs xmllint --valid >/dev/null

set +x
for PHP in $(find rsget.pl -name "index.php" -o -name "error*.php"); do
	echo "+ xmllint --valid $PHP"
	php $PHP | xmllint --valid - > /dev/null
done

echo
echo -n "Update servers [y/N] ? "
read ANS
[ "$ANS" = "y" ] || exit 0

set -x

cd rsget.pl

rsync -zctrlP --delay-updates --delete --delete-after \
	. sparky.homelinux.org:public_html/rsget.pl

rsync -zctrlP --delay-updates --delete --delete-after \
	. szamchat.xatka.net:public_html/rsget.pl

echo "All done !"
